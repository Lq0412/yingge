# 5 天开发与文档计划（当前状态版）

> 目标：交付英歌舞在线试装后端可用版本，支撑注册/登录、图片上传、异步试装任务与接口文档。

## 1. 当前进展
- 账号：注册/登录（BCrypt），Session 鉴权，`@LoginRequired`/`@AdminRequired` 拦截。
- 上传：封装 COS 上传工具（`CosManager`/`FilePictureUpload`），未暴露上传接口。
- 试装：新增异步任务表 `try_on_task`，接口 `POST /api/tasks/tryon` / `GET /api/tasks/tryon/{id}`，后台调用火山 Ark 接口（同步获取结果 URL，写回任务）。
- 配置：`application-local.yml` 含 MySQL、COS、Seedream、Volcengine 配置（含明文，需后续示例化）。
- 文档：`prd.md` 已重写；未更新本计划（现文档即最新）。

## 2. 待完成的成果
- 图片上传接口：返回 COS URL，供试装任务使用。
- 试装记录闭环：按需启用 `try_on_record` 表（保存人像/服装/结果，状态/错误），提供列表/详情。
- 结果存储优化：火山返回结果下载后上传 COS，保存内部可控 URL。
- 文档完善：Swagger/Knife4j 对齐接口；提供配置示例（移除敏感信息）。
- 测试与验证：主要流程与异常路径。

## 3. 未来 5 天拆解（建议）
### 第 1 天：上传与配置
- 暴露图片上传接口（校验 jpg/png/≤5MB），复用 `FilePictureUpload`。
- 将 COS/Volcengine/Seedream 配置抽成示例文件或改为环境变量说明。

### 第 2 天：试装记录
- 基于 `try_on_record` 表实现记录写入/查询（列表/详情，仅本人）。
- 任务完成时同步写入记录（成功/失败）。

### 第 3 天：结果存储与异步优化
- 任务处理时下载结果图并上传到 COS，记录内部 URL。
- 检查线程池/超时/重试策略，完善错误映射。

### 第 4 天：接口文档与鉴权
- 补充 Swagger/Knife4j 注解，标注鉴权要求。
- 检查统一错误返回与异常处理。

### 第 5 天：测试与收尾
- 自测全流程（上传 → 提交任务 → 轮询任务 → 查看记录）。
- 补充必要的集成测试/手册，更新 `prd.md` 与本计划状态。

## 4. 风险与TODO
- 配置安全：local.yml 含明文密钥，需示例化或环境变量。
- 外部依赖：火山接口返回格式/延迟不确定，需实际验证。
- 数据库：本地无 MySQL 时构建会失败，可按需引入 H2/跳过测试。
